# LizardFS

This project creates one Docker image containing all [LizardFS](https://lizardfs.com/) components. With this image a container for each LizardFS component can be created.

The LizardFS version included in the image is 3.12.0. The base operating system is Ubunt 18.04.

# Usage

## Volumes

Two directories are exposed by the image:

* /etc/lizardfs - config files
* /var/lib/lizardfs - LizardFS data

The configuration files, if missing, are generated by the container. Once generated, the files can be modified by the user.

## Environment Variables

The behavior of the containers can be configured using the following environment variables:

* MASTER - points to the IP address of the LizardFS master instance (e.g. 192.168.0.100)
* EXPORTS_IP_CLASS - defines IP class that is allowed to access storage (e.g. 192.168.0.0/24)

## Starting Components

MASTER, EXPORTS_IP_CLASS and the mounted directories have to be adapted accordingly.

### Master

```shell
docker run -ti --rm --privileged --network host -e EXPORTS_IP_CLASS="192.168.0.0/24" -e MASTER="192.168.0.100" -v $(pwd)/config:/etc/lizardfs -v $(pwd)/data:/var/lib/lizardfs darxkies/lizardfs:0.2.0 master
```

### Master Shadow

```shell
docker run -ti --rm --privileged --network host -e EXPORTS_IP_CLASS="192.168.0.0/24" -e MASTER="192.168.0.100" -v $(pwd)/config:/etc/lizardfs -v $(pwd)/data:/var/lib/lizardfs darxkies/lizardfs:0.2.0 shadow
```

### Metalogger

```shell
docker run -ti --rm --privileged --network host -e EXPORTS_IP_CLASS="192.168.0.0/24" -e MASTER="192.168.0.100" -v $(pwd)/config:/etc/lizardfs -v $(pwd)/data:/var/lib/lizardfs darxkies/lizardfs:0.2.0 metalogger
```

### Chunk Server

```shell
docker run -ti --rm --privileged --network host -e EXPORTS_IP_CLASS="192.168.0.0/24" -e MASTER="192.168.0.100" -v $(pwd)/config:/etc/lizardfs -v $(pwd)/data:/var/lib/lizardfs darxkies/lizardfs:0.2.0 chunkserver
```

### CGI Server

```shell
docker run -ti --rm --privileged --network host -e EXPORTS_IP_CLASS="192.168.0.0/24" -e MASTER="192.168.0.100" -v $(pwd)/config:/etc/lizardfs -v $(pwd)/data:/var/lib/lizardfs darxkies/lizardfs:0.2.0 cgiserver
```

The CGI Server can be accessed by opening http://192.168.0.100:9425

### Shell

This starts a shell session in a container in case data has to be repaired.

```shell
docker run -ti --rm --privileged --network host -e EXPORTS_IP_CLASS="192.168.0.0/24" -e MASTER="192.168.0.100" -v $(pwd)/config:/etc/lizardfs -v $(pwd)/data:/var/lib/lizardfs darxkies/lizardfs:0.2.0 shell
```
